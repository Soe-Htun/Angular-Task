<div class="overflow-hidden rounded-2xl border border-slate-800/70 bg-slate-900/70 shadow-xl shadow-indigo-500/10">
  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-slate-800">
      <thead class="bg-slate-900/80">
        <tr>
          <th scope="col" class="px-6 py-4 text-left text-xs font-semibold uppercase tracking-[0.2em] text-slate-400">
            Title
          </th>
          <th scope="col" class="px-6 py-4 text-left text-xs font-semibold uppercase tracking-[0.2em] text-slate-400">
            Priority
          </th>
          <th scope="col" class="px-6 py-4 text-left text-xs font-semibold uppercase tracking-[0.2em] text-slate-400">
            Status
          </th>
          <th scope="col" class="px-6 py-4 text-right text-xs font-semibold uppercase tracking-[0.2em] text-slate-400">
            Actions
          </th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-800 bg-slate-900/40">
        <ng-container *ngIf="(loading() && !hasLoaded()) || !pageData(); else loadedRows">
          <ng-container *ngTemplateOutlet="skeletonRows"></ng-container>
        </ng-container>

        <ng-template #loadedRows>
          <ng-container *ngIf="pageData() as page">
            <ng-container *ngIf="page.items.length; else emptyState">
              <tr
                *ngFor="let task of page.items; trackBy: trackById"
                class="cursor-pointer transition hover:bg-slate-800/60"
                [ngClass]="{ 'bg-slate-800/70': activeTaskId === task.id }"
                (click)="onRowClick(task)"
              >
                <td class="px-6 py-4">
                  <div class="flex flex-col gap-1">
                    <p class="text-sm font-semibold text-white">{{ task.title }}</p>
                    <p class="text-xs text-slate-300 line-clamp-2">{{ task.description }}</p>
                  </div>
                </td>
                <td class="px-6 py-4">
                  <span [appTaskBadge]="task.priority">{{ task.priority }}</span>
                </td>
                <td class="px-6 py-4">
                  <span [appTaskBadge]="task.status">{{ task.status }}</span>
                </td>
                <td class="px-6 py-4 text-right text-sm">
                  <div class="flex justify-end gap-2">
                    <button
                      type="button"
                      class="rounded-lg border border-slate-700 px-3 py-1.5 text-xs font-semibold text-slate-100 transition hover:border-indigo-400 hover:text-indigo-200"
                      (click)="editTask(task)"
                      (click)="$event.stopPropagation()"
                    >
                      Edit
                    </button>
                    <button
                      type="button"
                      class="rounded-lg border border-slate-700 px-3 py-1.5 text-xs font-semibold text-rose-200 transition hover:border-rose-400 hover:text-rose-100"
                      (click)="deleteTask(task)"
                      (click)="$event.stopPropagation()"
                    >
                      Delete
                    </button>
                  </div>
                </td>
              </tr>
            </ng-container>
          </ng-container>
        </ng-template>
        <ng-template #skeletonRows>
          <tr *ngFor="let _ of [1,2,3,4,5]; let i = index">
            <td class="px-6 py-5">
              <div class="h-4 w-48 animate-pulse rounded bg-slate-800"></div>
              <div class="mt-2 h-3 w-72 animate-pulse rounded bg-slate-800"></div>
            </td>
            <td class="px-6 py-5">
              <div class="h-8 w-24 animate-pulse rounded bg-slate-800"></div>
            </td>
            <td class="px-6 py-5">
              <div class="h-8 w-28 animate-pulse rounded bg-slate-800"></div>
            </td>
            <td class="px-6 py-5 text-right">
              <div class="ml-auto h-8 w-28 animate-pulse rounded bg-slate-800"></div>
            </td>
          </tr>
        </ng-template>
      </tbody>
    </table>
  </div>
</div>

<div class="mt-3 rounded-2xl border border-slate-800/70 bg-slate-900/70">
  <app-pagination
    [page]="page()"
    [pageSize]="pageSize()"
    [total]="total()"
    [pageSizeOptions]="[5, 10, 20]"
    (pageChange)="changePage($event)"
    (pageSizeChange)="changePageSize($event)"
  />
</div>

<ng-template #emptyState>
  <tr>
    <td colspan="4" class="px-6 py-10 text-center text-sm text-slate-300">No tasks found for this filter.</td>
  </tr>
</ng-template>
