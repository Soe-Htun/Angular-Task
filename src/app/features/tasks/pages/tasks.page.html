<section class="min-h-screen bg-slate-950 text-slate-100">
  <div class="mx-auto flex max-w-6xl flex-col gap-6 px-4 py-6 lg:px-0">
    <header class="flex flex-col justify-between gap-4 sm:flex-row sm:items-center">
      <div>
        <p class="text-sm uppercase tracking-[0.2em] text-indigo-300/80">Tasks</p>
        <h1 class="text-3xl font-semibold text-white sm:text-4xl">Task Management</h1>
        <p class="mt-1 text-sm text-slate-300">Create, track, and update work items with quick filters.</p>
      </div>
      <div class="flex flex-wrap gap-3">
        <button
          type="button"
          class="inline-flex items-center gap-2 rounded-xl bg-indigo-500 px-4 py-2.5 text-sm font-semibold text-slate-50 shadow-lg shadow-indigo-500/30 transition hover:-translate-y-0.5 hover:bg-indigo-400"
          (click)="openCreateModal()"
        >
          + New task
        </button>
      </div>
    </header>

    <div class="grid gap-4 rounded-2xl border border-slate-800/80 bg-slate-900/60 p-4 shadow-xl shadow-emerald-500/10 sm:grid-cols-2 lg:grid-cols-4">
      <label class="flex flex-col gap-2 text-xs font-semibold uppercase tracking-[0.2em] text-slate-400">
        Status
        <select
          class="rounded-lg border border-slate-800 bg-slate-900 px-3 py-2 text-sm font-semibold text-slate-100 focus:border-indigo-400 focus:outline-none"
          [value]="filters().status ?? 'all'"
          (change)="changeFilter('status', $any($event.target).value)"
        >
          <option value="all">All</option>
          @for (status of statusOptions; track status) {
            <option [value]="status" class="capitalize">{{ status }}</option>
          }
        </select>
      </label>

      <label class="flex flex-col gap-2 text-xs font-semibold uppercase tracking-[0.2em] text-slate-400">
        Priority
        <select
          class="rounded-lg border border-slate-800 bg-slate-900 px-3 py-2 text-sm font-semibold text-slate-100 focus:border-indigo-400 focus:outline-none"
          [value]="filters().priority ?? 'all'"
          (change)="changeFilter('priority', $any($event.target).value)"
        >
          <option value="all">All</option>
          @for (priority of priorityOptions; track priority) {
            <option [value]="priority" class="capitalize">{{ priority }}</option>
          }
        </select>
      </label>

      <div class="flex items-end justify-end sm:col-span-2 lg:col-span-2">
        <button
          type="button"
          class="rounded-lg border border-slate-800 px-4 py-2 text-sm font-semibold text-slate-200 transition hover:border-indigo-400 hover:text-indigo-200"
          (click)="clearFilters()"
        >
          Clear filters
        </button>
        </div>
      </div>

    <div class="mt-6">
      <app-task-list
        [filters]="filters()"
        (selected)="handleSelect($event)"
        (edit)="openEditModal($event)"
        (remove)="deleteTask($event)"
      />
    </div>

    <app-modal [open]="createModalOpen()" title="Create task" (closed)="closeCreateModal()">
      <form class="space-y-4" [formGroup]="taskForm" (ngSubmit)="submitCreate()">
        <label class="flex flex-col gap-2 text-sm font-medium text-slate-200">
          <span class="flex items-center gap-1">
            Title <span class="text-rose-400">*</span>
          </span>
          <input
            class="rounded-lg bg-slate-900 px-3 py-2 text-slate-100 focus:outline-none"
            [ngClass]="hasError('title') ? 'border border-rose-400 focus:border-rose-400' : 'border border-slate-800 focus:border-indigo-400'"
            type="text"
            formControlName="title"
            placeholder="Define sprint goals"
          />
          @if (getFieldError('title'); as error) {
            <span class="text-xs font-semibold text-rose-400">{{ error }}</span>
          }
        </label>

        <label class="flex flex-col gap-2 text-sm font-medium text-slate-200">
          <span class="flex items-center gap-1">
            Description <span class="text-slate-500 text-xs">(optional)</span>
          </span>
          <textarea
            rows="3"
            class="rounded-lg border border-slate-800 bg-slate-900 px-3 py-2 text-slate-100 focus:border-indigo-400 focus:outline-none"
            formControlName="description"
            placeholder="Add more detail about this task"
          ></textarea>
          @if (getFieldError('description'); as error) {
            <span class="text-xs font-semibold text-rose-400">{{ error }}</span>
          }
        </label>

        <div class="grid gap-4 sm:grid-cols-2">
          <label class="flex flex-col gap-2 text-sm font-medium text-slate-200">
            <span class="flex items-center gap-1">
              Priority <span class="text-rose-400">*</span>
            </span>
            <select
              class="rounded-lg bg-slate-900 px-3 py-2 text-sm font-semibold text-slate-100 focus:outline-none"
              [ngClass]="hasError('priority') ? 'border border-rose-400 focus:border-rose-400' : 'border border-slate-800 focus:border-indigo-400'"
              formControlName="priority"
            >
              @for (priority of priorityOptions; track priority) {
                <option [value]="priority" class="capitalize">{{ priority }}</option>
              }
            </select>
          </label>
          <label class="flex flex-col gap-2 text-sm font-medium text-slate-200">
            <span class="flex items-center gap-1">
              Status <span class="text-rose-400">*</span>
            </span>
            <select
              class="rounded-lg bg-slate-900 px-3 py-2 text-sm font-semibold text-slate-100 focus:outline-none"
              [ngClass]="hasError('status') ? 'border border-rose-400 focus:border-rose-400' : 'border border-slate-800 focus:border-indigo-400'"
              formControlName="status"
            >
              @for (status of statusOptions; track status) {
                <option [value]="status" class="capitalize">{{ status }}</option>
              }
            </select>
          </label>
        </div>

        <div class="flex justify-end gap-3 pt-2">
          <button
            type="button"
            class="rounded-lg border border-slate-700 px-4 py-2 text-sm font-semibold text-slate-200 transition hover:border-slate-500"
            (click)="closeCreateModal()"
          >
            Cancel
          </button>
          <button
            type="submit"
            class="rounded-lg bg-indigo-500 px-4 py-2 text-sm font-semibold text-slate-900 transition hover:bg-indigo-400"
          >
            Save task
          </button>
        </div>
      </form>
    </app-modal>

    <app-modal [open]="editModalOpen()" title="Edit task" (closed)="closeEditModal()">
      <form class="space-y-4" [formGroup]="taskForm" (ngSubmit)="submitUpdate()">
        <label class="flex flex-col gap-2 text-sm font-medium text-slate-200">
          <span class="flex items-center gap-1">
            Title <span class="text-rose-400">*</span>
          </span>
          <input
            class="rounded-lg bg-slate-900 px-3 py-2 text-slate-100 focus:outline-none"
            [ngClass]="hasError('title') ? 'border border-rose-400 focus:border-rose-400' : 'border border-slate-800 focus:border-indigo-400'"
            type="text"
            formControlName="title"
            placeholder="Define sprint goals"
          />
          @if (getFieldError('title'); as error) {
            <span class="text-xs font-semibold text-rose-400">{{ error }}</span>
          }
        </label>

        <label class="flex flex-col gap-2 text-sm font-medium text-slate-200">
          <span class="flex items-center gap-1">
            Description <span class="text-slate-500 text-xs">(optional)</span>
          </span>
          <textarea
            rows="3"
            class="rounded-lg border border-slate-800 bg-slate-900 px-3 py-2 text-slate-100 focus:border-indigo-400 focus:outline-none"
            formControlName="description"
            placeholder="Add more detail about this task"
          ></textarea>
          @if (getFieldError('description'); as error) {
            <span class="text-xs font-semibold text-rose-400">{{ error }}</span>
          }
        </label>

        <div class="grid gap-4 sm:grid-cols-2">
          <label class="flex flex-col gap-2 text-sm font-medium text-slate-200">
            <span class="flex items-center gap-1">
              Priority <span class="text-rose-400">*</span>
            </span>
            <select
              class="rounded-lg bg-slate-900 px-3 py-2 text-sm font-semibold text-slate-100 focus:outline-none"
              [ngClass]="hasError('priority') ? 'border border-rose-400 focus:border-rose-400' : 'border border-slate-800 focus:border-indigo-400'"
              formControlName="priority"
            >
              @for (priority of priorityOptions; track priority) {
                <option [value]="priority" class="capitalize">{{ priority }}</option>
              }
            </select>
          </label>
          <label class="flex flex-col gap-2 text-sm font-medium text-slate-200">
            <span class="flex items-center gap-1">
              Status <span class="text-rose-400">*</span>
            </span>
            <select
              class="rounded-lg bg-slate-900 px-3 py-2 text-sm font-semibold text-slate-100 focus:outline-none"
              [ngClass]="hasError('status') ? 'border border-rose-400 focus:border-rose-400' : 'border border-slate-800 focus:border-indigo-400'"
              formControlName="status"
            >
              @for (status of statusOptions; track status) {
                <option [value]="status" class="capitalize">{{ status }}</option>
              }
            </select>
          </label>
        </div>

        <div class="flex justify-end gap-3 pt-2">
          <button
            type="button"
            class="rounded-lg border border-slate-700 px-4 py-2 text-sm font-semibold text-slate-200 transition hover:border-slate-500"
            (click)="closeEditModal()"
          >
            Cancel
          </button>
          <button
            type="submit"
            class="rounded-lg bg-indigo-500 px-4 py-2 text-sm font-semibold text-slate-900 transition hover:bg-indigo-400"
          >
            Update task
          </button>
        </div>
      </form>
    </app-modal>

    <app-modal [open]="deleteModalOpen()" title="Confirm delete" (closed)="closeDeleteModal()">
      <div class="space-y-4 text-sm text-slate-200">
        <p>Are you sure you want to delete this task?</p>
        @if (pendingDelete(); as task) {
          <div class="rounded-lg border border-slate-800 bg-slate-900 px-4 py-3 text-xs text-slate-300">
            <div class="font-semibold text-slate-100">{{ task.title }}</div>
            <div class="capitalize text-slate-400">Priority: {{ task.priority }} Â· Status: {{ task.status }}</div>
          </div>
        }
        <div class="flex justify-end gap-3 pt-2">
          <button
            type="button"
            class="rounded-lg border border-slate-700 px-4 py-2 text-sm font-semibold text-slate-200 transition hover:border-slate-500"
            (click)="closeDeleteModal()"
          >
            No, keep
          </button>
          <button
            type="button"
            class="rounded-lg bg-rose-500 px-4 py-2 text-sm font-semibold text-slate-50 transition hover:bg-rose-400"
            (click)="confirmDelete()"
          >
            Yes, delete
          </button>
        </div>
      </div>
    </app-modal>
  </div>
</section>
